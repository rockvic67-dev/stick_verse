<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StickVerse | Indie Anime Streaming</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#0b0b10; color:#fff; }
    header { display:flex; justify-content:space-between; align-items:center; padding:16px 32px; background:#111118; position:sticky; top:0; z-index:10; }
    header h1 { margin:0; color:#ff2d75; cursor:pointer; }
    nav a { margin-left:20px; text-decoration:none; color:#fff; font-weight:bold; cursor:pointer; }
    nav a:hover { color:#ff2d75; }

    .page { display:none; }
    .page.active { display:block; }

    .hero { height:60vh; background:linear-gradient(rgba(0,0,0,.6), rgba(0,0,0,.9)), url('https://via.placeholder.com/1600x900') center/cover no-repeat; display:flex; align-items:flex-end; padding:40px; }
    .hero h2 { font-size:3rem; margin:0; }
    .hero button { margin-top:20px; padding:12px 24px; font-size:1rem; background:#ff2d75; border:none; color:#fff; cursor:pointer; border-radius:6px; }

    .section { padding:40px; }
    .row { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; }
    .anime-card { background:#16161f; border-radius:10px; overflow:hidden; cursor:pointer; transition:transform .3s; }
    .anime-card:hover { transform:scale(1.05); }
    .anime-card img { width:100%; height:300px; object-fit:cover; }
    .info { padding:12px; }

    .player { max-width:1000px; margin:auto; background:#000; border-radius:10px; overflow:hidden; }
    .player video { width:100%; }

    .episode-list { max-width:1000px; margin:20px auto; }
    .episode { padding:12px; background:#16161f; margin-bottom:10px; border-radius:6px; cursor:pointer; }
    .episode.active { background:#ff2d75; }

    .creator-box { max-width:500px; margin:60px auto; background:#15151d; padding:30px; border-radius:10px; }
    .creator-box input { width:100%; padding:10px; margin-bottom:12px; border-radius:6px; border:none; }
    .creator-box button { width:100%; padding:10px; background:#ff2d75; border:none; color:#fff; cursor:pointer; border-radius:6px; }

    footer { text-align:center; padding:20px; background:#111118; color:#aaa; }
  </style>
</head>
<body>

<header>
  <h1 onclick="go('home')">StickVerse</h1>
  <nav>
    <a onclick="go('home')">Home</a>
    <a onclick="go('series')">Series</a>
    <a onclick="go('watch')">Watch</a>
    <a onclick="go('creator')">Creator Upload</a>
  </nav>
</header>

<div id="home" class="page active">
  <section class="hero">
    <div>
      <h2>StickVerse Originals</h2>
      <p>Indie anime. Creator-owned.</p>
      <button onclick="go('series')">Browse Series</button>
    </div>
  </section>
</div>

<div id="series" class="page">
  <section class="section">
    <h2>Series</h2>
    <div class="row" id="seriesRow"></div>
    <p id="emptyNotice" style="color:#aaa; display:none">No series uploaded yet.</p>
  </section>
</div>

<div id="watch" class="page">
  <section class="section">
    <h2 id="watchTitle">Select a series</h2>
    <div class="player"><video id="video" controls></video></div>
    <div class="episode-list" id="episodeList"></div>
  </section>
</div>

<div id="creator" class="page">
  <div class="creator-box">
    <h2>Upload Anime</h2>
    <input id="creatorTitle" placeholder="Series Title" />
    <input id="creatorPoster" placeholder="Poster Image URL (optional)" />
    <input id="creatorVideoFile" type="file" accept="video/*" />
    <button onclick="submitAnime()">Upload Episode 1</button>
  </div>
</div>

<footer>Â© 2026 StickVerse</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA23V1vAXR9GmPlSzpcoxNdIelA97okhtg",
    authDomain: "stickverse-6998b.firebaseapp.com",
    projectId: "stickverse-6998b",
    storageBucket: "stickverse-6998b.appspot.com",
    messagingSenderId: "592639288866",
    appId: "1:592639288866:web:f3e5cbf0ac4a35bf72cc7b"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  window.go = p => {
    document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
    document.getElementById(p).classList.add('active');
  };

  async function loadSeries() {
    const row = document.getElementById('seriesRow');
    const empty = document.getElementById('emptyNotice');
    row.innerHTML = '';

    const snap = await getDocs(collection(db, 'series'));
    if (snap.empty) { empty.style.display = 'block'; return; }
    empty.style.display = 'none';

    snap.forEach(d => {
      const s = d.data();
      if (!s?.title || !Array.isArray(s.episodes)) return;
      const card = document.createElement('div');
      card.className = 'anime-card';
      card.innerHTML = `<img src="${s.poster || 'https://via.placeholder.com/400x600'}"><div class='info'><h3>${s.title}</h3></div>`;
      card.onclick = () => loadEpisodes(s);
      row.appendChild(card);
    });
  }

  window.loadEpisodes = series => {
    const list = document.getElementById('episodeList');
    list.innerHTML = '';
    document.getElementById('watchTitle').textContent = `Watching: ${series.title}`;

    series.episodes.forEach((ep, i) => {
      if (!ep.src) return;
      const e = document.createElement('div');
      e.className = 'episode';
      e.textContent = ep.title || `Episode ${i+1}`;
      e.onclick = () => playEpisode(ep.src, i);
      list.appendChild(e);
    });

    if (series.episodes.length) playEpisode(series.episodes[0].src, 0);
    go('watch');
  };

  function playEpisode(src, idx) {
    const v = document.getElementById('video');
    v.src = src;
    v.play();
    document.querySelectorAll('.episode').forEach(e => e.classList.remove('active'));
    document.querySelectorAll('.episode')[idx]?.classList.add('active');
  }

  window.submitAnime = async () => {
    const title = creatorTitle.value.trim();
    const poster = creatorPoster.value.trim();
    const file = creatorVideoFile.files[0];

    if (!title || !file) return alert('Title and video required');

    const fileRef = ref(storage, `videos/${Date.now()}_${file.name}`);
    await uploadBytes(fileRef, file);
    const url = await getDownloadURL(fileRef);

    await addDoc(collection(db, 'series'), {
      title,
      poster,
      episodes: [{ title: 'Episode 1', src: url }],
      createdAt: Date.now()
    });

    alert('Upload complete');
    go('series');
    loadSeries();
  };

  loadSeries();
</script>

</body>
</html>
